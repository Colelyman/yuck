package yuck.core

/**
 * Helper for implementing variables.
 *
 * @author Michael Marte
 */
trait DomainHolder[Value <: AnyValue, Domain <: yuck.core.Domain[Value]] {

    protected var currentDomain: Domain
    protected def thisVariable: Variable[Value]
    protected def intersectCurrentDomainWith(domain: Domain): Domain

    final def pruneDomainImpl(restriction: Domain): Boolean = {
        if (restriction != currentDomain) {
            // Assuming that restriction is usually a subset of currentDomain,
            // we avoid useless and expensive intersections.
            if (restriction.isSubsetOf(currentDomain)) {
                currentDomain = restriction
            } else {
                currentDomain = intersectCurrentDomainWith(restriction)
            }
            if (currentDomain.isEmpty) {
                throw new DomainWipeOutException(thisVariable)
            }
            true
        } else {
            false
        }
    }

    final def relaxDomainImpl(relaxation: Domain): Boolean = {
        if (relaxation != currentDomain) {
            require(
                currentDomain.isSubsetOf(relaxation),
                "%s is not a superset of %s".format(relaxation, currentDomain))
            require(currentDomain.isSubsetOf(relaxation))
            currentDomain = relaxation
            true
        } else {
            false
        }
    }

}

